# 知识库管理系统---知识库明细编辑界面需求

## 项目路径

1. APP路径:api/backend_management/knowledge
2. APP下面的子模块名称: namespace
3. 用户APP模型的路径：/api/backend_management/user/models/user.py 你可以参考用户模型进行外键建模
4. Namespace模型的路径：api/backend_management/knowledge/models/namespace.py 你可以参考Namespace模型进行外键建模
5. API文档路径：api_schema.yaml（你去看一下就知道怎么对接服务端）
6. Web端APP子项目: new_web/src/views/KnowledgeManagement  你可以在new_web/src/views/KnowledgeManagement/components 中创建组件   可以在new_web/src/views/KnowledgeManagement/Main.vue中创建组件编排逻辑
7. 你通过new_web/src/views/KnowledgeNamespace/Main.vue 这个知识库Namespace的管理界面点击里面的知识库可以进入知识库编辑界面
8. API文档路径：api_schema.yaml（你去看一下就知道怎么对接服务端）

## 第一版需求

1. 通过Namespace的详情页面上的图标点击之后可以进入当前Namespace的知识管理界面。
   会产生三种类型的组件：1.左侧的树形结构菜单组件 2.右侧针对不同知识类型渲染的组件展示不同类型的知识。3.知识具体内容上方的知识元数据条目，展示知识标题，更新时间等。
   知识必然属于某个Namespace，知识必然属于某一个用户（创建者）。

   知识具体内容上方的栏目组件
2. 点击左侧菜单栏标题文字点击上方的按钮可以弹出其他的Namespace，包括我个人的和邀请协作的。
3. 左侧菜单栏上面有一个搜索框，点击后会在中间位置弹出搜索框，可以输入文字对文档的标题进行检索。
4. 左侧菜单栏搜索框右边的+号健点击之后可以添加知识。会弹出一个框可以进行知识的添加。
目前有三种类型的知识：1.文档知识 2.工具知识 3.表单知识。其他的功能不需要。
点击添加之后知识默认会在菜单栏最上方展示，标题默认为无标题文档。
5. 点击左侧菜单栏的首页可以在右侧看到整个知识库的目录树，以及知识库名称等信息。
6. 知识的父子关系管理。
1.点击父知识就可以把子知识展开。
2.点击父知识的添加按钮就可以弹出知识类型，点击后就会在父知识下面的第一个位置添加子知识
3.标题最多展示20个字符，超长的部分就展示......
7. 知识的编辑操作，点击右侧的三个点可以弹出一系列的知识编辑操作。
只要实现重命名，复制，移动，删除即可。
1.重命名：弹出一个框对知识进行重命名修改。
2.复制：中间弹出一个框：复制同一份知识到指定命名空间的某些目录下或者某个同级目录
3.移动：中间弹出一个框：把当前知识移动到指定命名空间的某些目录下或者某个同级目录
4.删除：点击后弹出一个删除确认框，寻味用户是否需要删除。点击后再删除。
8. 左侧菜单里面的节点都是可以拖动的。可以把一个知识拖到另外一个知识的下面，就变成了那个知识的子知识。可以拖动到同级目录下，就可以交换知识的展示位置。可以拖动到任意目录树的任何地方。父目录拖动子目录都会被级联拖动到另外的地方。
9. 不同类型的知识右侧弹出来的内容不一样 ，这一版实现三种类型的知识即可
1.文档知识 
文档知识就是富文本编辑器会在右侧展示
2.工具知识 
工具知识 就是一个form表单会在右侧展示
这一版简化一点表单的内容，输入：
1.工具名
2.工具描述
3.工具代码
3.表单知识
表单知识 也是一个form表单会在右侧展示
这一版简化一点表单的内容，输入：
1.表单名
2.表单字段 表单字段类型 默认值


📁 Web端文件结构如下：
new_web/src/views/KnowledgeManagement/
├── Main.vue                         # 主页面
└── components/
    ├── DocumentTree.vue             # 文档树
    ├── DocumentViewer.vue           # 文档查看器
    ├── CreateDocumentDialog.vue     # 新建文档对话框
    ├── MoveDocumentDialog.vue       # 移动文档对话框

# 第一版需求迭代
1.知识的分类功能不需要，直接移除：KnowledgeCategory
2.知识的Tag功能不需要，直接移除：KnowledgeTag
3.知识的版本功能不需要，直接移除：KnowledgeVersion
4.知识的评论功能不需要，直接移除：KnowledgeComment
5.知识的文档内需要调整的点：1.知识文档的附件文件不需要 2.浏览次数不需要：view_count


# 最新版需求：
核心目标：把三种类型的知识能够用不同类型的界面展示出来，数据库能建立对应的数据结构即可。
重点关注：1.什么类型的知识，有啥用？2.左侧菜单栏展示的内容  3.右侧展示的内容

## 2024年更新 - 工具创建界面简化

### 改动内容
简化了工具创建弹出框，移除了复杂的配置参数，只保留核心必要字段：

**保留的字段：**
- 工具标题
- 工具名称  
- 工具描述
- 父级目录（如果有）
- 权限设置

**移除的字段：**
- 工具类型选择
- 输入参数配置（动态参数添加/删除）
- 使用示例配置
- 工具代码编辑器

### 技术改动
- 简化了表单数据结构
- 移除了相关的方法（addParam, removeParam, updateInputSchema, addFewShot, removeFewShot）
- 简化了数据提交结构
- 移除了不必要的UI组件和样式

### 文件变更
```
new_web/src/views/KnowledgeManagement/components/
└── CreateToolDialog.vue  [已修改]
    ├── 移除复杂表单项
    ├── 简化JavaScript逻辑
    └── 清理CSS样式
```

1.第一种类型的知识：文档知识
通过新建文档可以创建文档知识，
A。左侧菜单栏：展示文档类型的知识，
B。右侧展示：Markdown类型的文本编辑器。

2.第二种类型的知识：工具知识
背景：本质上就是Agent的Tool的CRUD。未来可以被大模型调用，可以被人类直接使用。
右侧是一个动态表单，用于Tool的创建，接收信息。
Tool的结构如下：
1.name：名字（作用：用来告诉大模型是什么工具）
2.description：描述（作用：用来告诉大模型这个工具干了啥，什么时候使用）
3.input_schema：输入结构：json字符串：（作用：用来告诉大模型和人类这个工具要输入哪些参数，哪些是必填的，参数的描述告诉大模型怎么使用，参数类型总共4种：1.string 2.int 3.float 4.bool）要支持动态添加多输入字段。
json.dumps({
    "type": "object",
    "properties": {
        "ip_address": {"type": "string", "description": "IP地址"},
        "time": {"type": "string", "description": "申请时长"}
    },
    "required": ["ip_address", "time"]
})
4.few_shots：（作用：告诉大模型什么时候应该使用这个工具，告诉搜索引擎按照这种方式搜索才能更好地命中这个工具）通过列表list来存储。
json.dumps(
        [
            "我要申请一台192.168.3.211的机器,周期1个月。",
            "jms来一台机器",
            "jms机器192.168.9.100来一台，周期1周",
            "我要申请一台jms的机器"
        ]
    )
5.document_id  文档的主键  （不需要用户填写）
6.tenant 租户id。默认此处填写用户id即可。  （不需要用户填写）
7.namespace。工作空间id。  （不需要用户填写）
8.owner  用户id    （不需要用户填写）
9.tool_type   工具类型   （默认为：dynamic）以后会有多种选项，每一种选项表现形态不一样，需要用户填写。
10.extra_params：额外的参数  （作用：针对不同的tool_type会呈现出不同的形态，如果是dynamic类型的工具就会有code这个参数，这个时候前端就需要有Code编码的组件，默认是Python代码，代表这个工具做的事情，为后续AI编程埋下伏笔）
json.dumps(
        {
            "code": '''if not ip_address.startswith("192.168"):
    raise ToolException(f"IP地址不合法,必须以192.168开头,当前ip地址为{ip_address}")
result = f"申请机器成功,ip地址为{ip_address},申请时长为{time}"'''
        }
    )
你需要根据上面的需求增加一个这种类型的知识，并且能在前端界面左侧菜单栏的树形结构中添加这种知识，和文档知识可以同级，可以是父子关系。

第三种类型的知识：表单知识
背景：本质上就是一张pg数据库的表（这个表肯定要体现Namespace + owner的概念保证表的唯一性）。可以由用户指定动态字段进行创建表的Schema。
1.可以不断地往里面新增字段，支持5中类型的字段：String Integer Time Number Boolean。映射到PG里面的数据结构即可。
2.有是否必要的操作可以指定字段是否必填。
3.有删除的操作可以删除字段，有编辑的操作可以对表的字段进行编辑。有name的概念可以指定字段的名称。
4.还需要添加数据库描述信息，以方便AI大模型可以准确地认识要用哪个工具。并且未来可以配合few-shot一起使用。

5.创建好了表单之后还可以进入  表单知识详情页  