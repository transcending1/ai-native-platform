# 富文本编辑器普通知识管理需求描述

## 项目路径
1. APP路径:api/backend_management/knowledge
2. APP下面的子模块名称: knowledge_management 为核心模块
3. Web端APP子项目: new_web/src/views/KnowledgeManagement
4. 富文本编辑器：new_web/src/components/RichTextEditor.vue
5. 保存文本的组件：new_web/src/views/KnowledgeManagement/components/DocumentViewer.vue



## 第一版需求
前端发起PUT请求:url: http://localhost:8000/knowledge/namespaces/5/documents/29/
请求体：
{
"title": "Document Title",
"content": "<p>A plain paragraph having some <strong>bold</strong> and some <i>italic.</i></p><h1>Heading, level 1</h1><p>Intense quote</p><ul><li>first item in unordered list</li></ul><ol><li>first item in ordered list</li></ol><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA6gAAAJxCAYAAABPB597AACAAElEQVR4XuydBdhVxfbGbcXub/62nsKIsAAABYEFQAAAAWBBUAAIAFQQUAAGBBUAEAAFgQVAAAABYEFQAAgAVBBQAAYEFQAQAAWBBUAAAAFgQVAACABUEFAABgQVABAABYEFQAAAAWBBUAAIAFQQUAAGBBUAEAAFgQVAAAABYEFQAAgAVBBQAAYCGf4kqc36+sggAAAABJRU5ErkJggg==\"></p><figure class=\"table\"><table><tbody><tr><td>Qty</td><td>Id</td><td>Desc</td></tr><tr><td>3</td><td>101</td><td>Spam</td></tr><tr><td>7</td><td>422</td><td>Eggs</td></tr><tr><td>4</td><td>631</td><td>Spam, spam, eggs, and spam</td></tr></tbody></table></figure>",
"summary": "This is a summary of the document.",
}

需求：
1. 目前富文本编辑器内如果粘贴图片上传到后台就是base64编码的图片。而且content是html。 后台数据库里面不能使用 html 里面的base64编码存，需要使用Django内置的存储上传到cos桶。 桶内部key的前缀为:{namespace_id}/{document_id} 然后用图片的地址替换html里面的base64编码。
前端用了CKEditor这个富文本编辑器，图片的上传我看文档里面可以直接发起一个请求到后台去上传图片，然后直接转换成图片的URL地址。这样就可以了。
（就是我希望上面的请求体重的content字段里面的img 中的 src 是一个图片的url的形式来展示。估计你要帮忙提供一个图片上传的接口了）
2. api/backend_management/llm_api/settings/base.py 里面已经配置了默认的存储cos桶。 api/backend_management/llm_api/settings/dev_settings.py 里面已经配置了cos桶的配置
3. 然后你还需要帮忙把图片base64编码替换后的html内容转换成Markdown的格式。也存储一份到数据库中。
4. 转换成的markdown格式之后，你还需要帮忙存储到向量数据库中。向量数据库的CRUD接口可以参考单元测试用例，你用里面的方式去对接即可：
api/backend_management/core/indexing/tests/test_index.py  
（document_id为DB中的ID  tenant 和 owner就写成user_id 即可  new_markdown_document就是存储Markdown title存储文章标题）