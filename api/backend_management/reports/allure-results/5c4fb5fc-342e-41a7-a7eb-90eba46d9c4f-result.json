{"name": "test_can_edit_compatibility", "status": "failed", "statusDetails": {"message": "AssertionError: assert 'admin' == 'readonly'\n  - readonly\n  + admin", "trace": "self = <knowledge.tests.test_namespace.TestNamespaceAPI object at 0x10703ff50>\n\n    @allure.story(\"权限兼容性测试\")\n    def test_can_edit_compatibility(self):\n        \"\"\"测试can_edit字段的向后兼容性\"\"\"\n        with allure.step(\"创建知识库\"):\n            namespace = Namespace.objects.create(\n                name='兼容性测试知识库',\n                creator=self.user1\n            )\n    \n        with allure.step(\"使用旧的can_edit字段添加协作者\"):\n            self.client.force_authenticate(user=self.user1)\n            data = {\n                'username': self.user2.username,\n                'can_edit': True  # 使用旧字段\n            }\n            response = self.client.post(f'/knowledge/namespaces/{namespace.id}/add_collaborator/', data)\n    \n        with allure.step(\"验证兼容性转换\"):\n            assert response.status_code == status.HTTP_201_CREATED\n            assert response.data['role'] == 'admin'  # 应该转换为admin角色\n            assert response.data['can_edit'] == True\n    \n        with allure.step(\"使用旧字段更新权限\"):\n            collaborator_id = response.data['user']['id']\n            data = {'can_edit': False}\n            response = self.client.patch(\n                f'/knowledge/namespaces/{namespace.id}/collaborators/{collaborator_id}/',\n                data\n            )\n    \n        with allure.step(\"验证权限更新\"):\n            assert response.status_code == status.HTTP_200_OK\n>           assert response.data['role'] == 'readonly'  # 应该转换为readonly角色\nE           AssertionError: assert 'admin' == 'readonly'\nE             - readonly\nE             + admin\n\nknowledge/tests/test_namespace.py:437: AssertionError"}, "description": "测试can_edit字段的向后兼容性", "steps": [{"name": "创建知识库", "status": "passed", "start": 1753609519069, "stop": 1753609519127}, {"name": "使用旧的can_edit字段添加协作者", "status": "passed", "start": 1753609519127, "stop": 1753609519498}, {"name": "验证兼容性转换", "status": "passed", "start": 1753609519498, "stop": 1753609519498}, {"name": "使用旧字段更新权限", "status": "passed", "start": 1753609519498, "stop": 1753609519934}, {"name": "验证权限更新", "status": "failed", "statusDetails": {"message": "AssertionError: assert 'admin' == 'readonly'\n  - readonly\n  + admin\n", "trace": "  File \"/Users/zongjunyi/PycharmProjects/ai-native-platform/api/backend_management/knowledge/tests/test_namespace.py\", line 437, in test_can_edit_compatibility\n    assert response.data['role'] == 'readonly'  # 应该转换为readonly角色\n    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n"}, "start": 1753609519934, "stop": 1753609519935}], "attachments": [{"name": "log", "source": "efd57b34-ec0a-4838-93aa-5a20c42b74bb-attachment.txt", "type": "text/plain"}], "start": 1753609519069, "stop": 1753609519937, "uuid": "83be0ff6-e0d8-4fbf-9d69-bcc9bdab8818", "historyId": "41a6352e49ff8ddf199634ccb04e5726", "testCaseId": "41a6352e49ff8ddf199634ccb04e5726", "fullName": "knowledge.tests.test_namespace.TestNamespaceAPI#test_can_edit_compatibility", "labels": [{"name": "story", "value": "知识库API测试"}, {"name": "feature", "value": "知识库管理"}, {"name": "story", "value": "权限兼容性测试"}, {"name": "tag", "value": "django_db"}, {"name": "parentSuite", "value": "knowledge.tests"}, {"name": "suite", "value": "test_namespace"}, {"name": "subSuite", "value": "TestNamespaceAPI"}, {"name": "host", "value": "zongjunyi.local"}, {"name": "thread", "value": "90383-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "knowledge.tests.test_namespace"}]}